@{
    ViewData["Title"] = "Show";
    bool flag = false;
}
@model Wish_Box.ViewModels.UserPageViewModel

<div class="col-8 col-lg-8">
    <div class="user-info">
        <div style="width: 200px;height: 200px; float:left;">
            @if (Model.User.Avatar != null)
            {
                <img class="avatar" style="width: 200px;height: 200px;" src="@Url.Content(Model.User.Avatar)" />
            }
            else
            {
                <img class="avatar" style="width: 200px;height: 200px;" src="~/Content/default_profile.jpg" />
            }
        </div>
        <div class="user-info-block">
            <label class="user-name">@Model.User.Login</label>
            <br />
            <label class="user-place">@Model.User.City, @Model.User.Country</label>
            <div class="user-date">
                <img src="~/Content/calendar-512.png" style="width: 30px; height: 30px; margin-right: 5px;" />
                <label class="user-date-lb">@Model.User.dayOfBirth.ToShortDateString()</label>
            </div>
        </div>
        @if (Model.User.Login == User.Identity.Name)
        {
            <a class="btn btn-light btn-lg edit-profile" asp-area="" asp-controller="Account" asp-action="Edit">Редактировать профиль</a>
        }
        else
        {
            @if (!Model.Followers.Contains(Model.CurrentUser.Id))
            {
                <a class="follow-btn" asp-controller="Followings" asp-action="Add" asp-route-id="@Model.User.Id" id="follow">Подписаться</a>
                if (flag)
                {
                    Model.Followers.Add(Model.User.Id);
                    flag = false;
                }
            }
            else
            {                
                <a class="btn btn-ligh unfollow-btn" asp-controller="Followings" asp-action="Delete" asp-route-id="@Model.User.Id" id="unfollow">Отписаться</a>
                if (flag)
                {
                    Model.Followers.Remove(Model.User.Id);
                    flag = false;
                }
            }
        }
    </div>

    <div class="wishes">
        @foreach (var wish in Model.UserWishes)
        {

            @if (wish.UserId == Model.User.Id)
            {
                <div class="col-auto">
                    <div class="wish-show">
                        @if (Model.User.Login == Model.CurrentUser.Login)
                        {
                            <div class="dropdown">

                                <button onclick="myFunction(@wish.Id)" class="dropbtn">&#8226;&#8226;&#8226;</button>
                                @{
                                    string drop_id = "myDropdown" + wish.Id.ToString();
                                }
                                <div id="@drop_id" class="dropdown-content">
                                    <a asp-controller="Wish" asp-action="Edit" asp-route-id="@wish.Id">Редактировать желание</a>
                                    <a class="btn-delete" asp-controller="Wish" asp-action="Delete" asp-route-id="@wish.Id">Удалить желание</a>
                                </div>

                            </div>
                                    }

                        <label class="wish-desc">@wish.Description</label>
                        <div class="attachment">
                            @if (wish.Attachment != null)
                            {
                                <img src="@Url.Content(wish.Attachment)" />
                            }
                            else
                            {
                                <img src="~/Content/gift icon.png" />
                            }
                        </div>
                    </div>
                    <a class="btn btn-outline-dark btn-get-comments" asp-controller="Comments" asp-action="GetComments" asp-route-id="@wish.Id" data-id="@(wish.Id)">Комменты</a>
                    <div class="comment-section-@(wish.Id)"></div>
                </div>
             }
         }
    </div>
</div>


<script>
    function myFunction(id) {
        console.log(id);
        //console.log("myDropdown"+id);
        document.getElementById("myDropdown" + id).classList.toggle("show");
    }
    window.onclick = function (event) {
        if (!event.target.matches('.dropbtn')) {
            var dropdowns = document.getElementsByClassName("dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
                var openDropdown = dropdowns[i];
                if (openDropdown.classList.contains('show')) {
                    openDropdown.classList.remove('show');
                }
            }
        }
    }
</script>

@section scripts
{
    <script type="text/javascript">

        $(function () {
            $.ajaxSetup({ cache: false });
            $(".btn-delete").click(function (e) {
                console.log("delete button was pressed");
                e.preventDefault();
                $.get(this.href, function (data) {
                    $('#dialogContent').html(data);
                    $('#modDialog').modal('show');
                });
            });
        })
    </script>

    <script type="text/javascript">
        $(function () {
            $.ajaxSetup({ cache: false });
            $(".btn-get-comments").click(function (e) {
                console.log("comments button was pressed");
                e.preventDefault();
                var id = $(this).attr("data-id");
                $.get(this.href, function (data) {
                    $('.comment-section-' + id).empty();
                    $('.comment-section-' + id).prepend(data);
                });
            });
        })
    </script>
}

<script>
    follow.onclick = function (event) {
        console.log("follow button was pressed");
      @{flag = true;}
    }
    unfollow.onclick = function (event) {
        console.log("unfollow button was pressed");
      @{flag = true;}
    }
</script>
 
